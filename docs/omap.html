<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ルート地図（OpenLayers版）</title>
<link rel='stylesheet' href='common.css'>
</head>
<body>
<div class="menu">
<ul>
<li><a href="https://anineco.nyanta.jp/">電脳覚書</a> |</li>
<li><a href="https://anineco.nyanta.jp/bbs/">掲示板</a> &gt;</li>
<li><a href="https://github.com/anineco/">GitHub</a> |</li>
<li><a href=".">TOP</a> &gt;</li>
<li><a href="gpx2geojson.html">GPX2GeoJSON</a> |</li>
<li><a href="setup.html">設置方法（共通）</a> |</li>
<li>OpenLayers |</li>
<li><a href="lmap.html">Leaflet</a> |</li>
<li><a href="gmap.html">Google</a> |</li>
<li><a href="bmap.html">Bing</a></li>
</ul>
</div><!-- end menu -->
<h1>ルート地図（OpenLayers版）</h1>
<h2>表示例</h2>
<p style="text-align:center;">
<iframe width="640" height="480" style="border:none;"
  src="https://map.jpn.org/docs/omap_ex2.html?lat=35.913163&amp;lon=138.721400&amp;zoom=15&amp;url=share/routemap.geojson">
</iframe>
</p>
<h2>設置方法</h2>
<p>必要なファイル一式の入手方法については、<a href="setup.html">設置方法（共通）</a>を参照して下さい。適当なディレクトリにファイル一式を展開すると、次のように配置されます。</p>
<div class="src">
<div>ディレクトリ構成（OpenLayers関係）</div>
<pre>
gps-track-maps
├── docs/
│   ├── omap_ex2.html
│   ├── <b>omap_ex2.js</b>
│   ├── omap_ex2.js.map
│   ├── <b>omap_ex2.css</b>
│   ├── omap_ex2.css.map
│   └── share/
│       └── <b>routemap.geojson</b> （GeoJSONファイル）
├── node_modules/
├── package-lock.json
├── package.json
└── src/
    ├── omap_ex2.js
    ├── omap_ex2.css
    ├── lib/Popup.*
    └── lib/Toolbar.*
</pre>
</div><!-- .src -->
<p>表示例のようなOpenLayers版ルート地図を表示するには、対象サイトに下記のディレクトリ構成図のようにファイルを設置し、対象ページに表示のためのコードを挿入します。<b>赤字</b>が必須ファイルで、'*.map'はデバッグのみに用いるソースマップで、通常は不要です。</p>
<div class="src">
<div>ディレクトリ構成図</div>
<pre>
.
├── your_page.html（対象ページ）
├── <b>omap_ex2.html</b>
├── <b>omap_ex2.js</b>
├── omap_ex2.js.map
├── <b>omap_ex2.css</b>
├── omap_ex2.css.map
└── share
    └── <b>routemap.geojson</b>
</pre>
</div><!-- .src -->
<div class="src">
<div>対象ページに挿入するコード</div>
<pre>
&lt;iframe width=&quot;640&quot; height=&quot;480&quot; style=&quot;border:none;&quot;
 src=&quot;<b>omap_ex2.html</b>?lat=35.913163&amp;lon=138.721400&amp;zoom=15&amp;url=<b>share/routemap.geojson</b>&quot;&gt;
&lt;/iframe&gt;
</pre>
</div><!-- .src -->
<p><b>！重要！</b>omap_ex2.htmlは11行目の'_YOUR_API_KEY_'の個所に各自が取得したBing Maps Keyを記入してから、設置してください。'_YOUR_API_KEY_'を空欄にすると、代わりに地理院タイルの写真を表示します。</p>
<div class="src">
<div>omap_ex2.html</div>
<pre class="prettyprint linenums" data-url="https://raw.githubusercontent.com/anineco/gps-track-maps/master/docs/omap_ex2.html"></pre>
</div><!-- .src -->
<div class="src">
<div>omap_ex2.html 変更個所（11行目）</div>
<pre><span style="color:gray;">&lt;div id=&quot;map&quot; data-bingmaps-key=&quot;<b>_YOUR_API_KEY_</b>&quot;&gt;&lt;/div&gt;</span></pre>
<div>地理院タイルの写真を用いる場合</div>
<pre><span style="color:gray;">&lt;div id=&quot;map&quot; data-bingmaps-key=&quot;&quot;&gt;&lt;/div&gt;</span></pre>
</div><!-- .src -->
<p>その他の表示方式（別窓ポップアップ）については、<a href="setup.html">設置方法（共通）</a>を参照して下さい。なお、'omap_ex2.html'以外のファイルは軽量化（minify）されているので、編集できません。編集はソースコードに対して行い、その後、次節で説明する処理が必要です。</p>
<h2>カスタマイズ</h2>
<p>ソースコードを利用してカスタマイズする場合には、<b>npm</b>（パッケージ管理システム）が必須です。Windows 10でgitやnpmを使うには、Windows Subsystem for Linux（WSL）の<b>Ubuntu</b>を利用するのが最も手軽と思います（作者はmacOSでMacPortsを利用しているので、Windowsについては詳しくありませんが）。UbuntuはMicrosoftストアから無料でインストールでき、<b>git</b>（バージョン管理システム）も標準で使えるので、ソースコードの取得にも便利に使えます。Ubuntuの準備に関しては<a href="setup.html">設置方法（共通）</a>を参照して下さい。</p>
<p>Ubuntuを起動してBashシェルの窓を開いたら、次のコマンドを実行します。</p>
<div class="src">
<div>コマンド実行：ソースコードの入手</div>
<pre>git clone https://github.com/anineco/gps-track-maps.git</pre>
<div>コマンド実行：モジュールのインストール</div>
<pre>
cd gps-track-maps
npm update
</pre>
</div><!-- .src -->
<p>上記のコマンドを実行すると、次のようなディレクトリ構成でファイル一式が得られます。このうち、ディレクトリnode_modulesは'npm update'を実行すると作成され、その中に必要なモジュールがインストールされます。</p>
<p>編集後、'npm run build'を実行するとdocs以下のファイルが更新されます。生成ファイルをウェブサイトに設置し、閲覧してOKならば作業完了です。</p>
<div class="src">
<div>ディレクトリ構成図（OpenLayers関係のみ抜粋）</div>
<pre>
gps-track-maps
├── docs/
|   ├── <b>omap_ex2.html</b>
│   └── share/
│       └── routemap.geojson （GeoJSONファイル）
├── node_modules/
├── package-lock.json
├── package.json
└── src/
    ├── <b>omap_ex2.js</b>
    ├── <b>omap_ex2.css</b>
    ├── lib/Popup.*
    └── lib/Toolbar.*
</pre>
</div>
<p>編集後、'npm run build'を実行するとdocsの中のomap_ex2.jsとomap_ex2.csが更新されるので、これを用いて再度設置を行い、閲覧してOKならば作業完了です。</p>
<div class="src">
<div>コマンド実行：ビルド</div>
<pre>
npm run build
</pre>
</div>
<p>なお、ソースコードは最新仕様のJavaScript（ES2015）を用いて記述され、かなり高度な知識(^^;)が必要です。Ubuntuをインストールしなくても、GitHubの<a href="https://github.com/anineco/gps-track-maps">gps-track-maps</a>のサイトで各ファイルを閲覧することができます。参考に私が作成した部分のJavaScriptのソースコードを下記に示します。</p>
<div class="src">
<div>omap_ex2.js</div>
<pre class="prettyprint linenums" data-url="https://raw.githubusercontent.com/anineco/gps-track-maps/master/src/omap_ex2.js"></pre>
<div>lib/Toolbar.js</div>
<pre class="prettyprint linenums" data-url="https://raw.githubusercontent.com/anineco/gps-track-maps/master/src/lib/Toolbar.js"></pre>
<div>lib/Popup.js</div>
<pre class="prettyprint linenums" data-url="https://raw.githubusercontent.com/anineco/gps-track-maps/master/src/lib/Popup.js"></pre>
</div><!-- .src -->
<h2>参考URL</h2>
<ul>
<li>OpenLayers - <a href="https://openlayers.org/en/latest/doc/tutorials/">Tutorials</a></li>
</ul>
<hr>
<address>&copy; 2019 <a href="https://anineco.nyanta.jp/">あにねこ電脳覚書</a></address>
<script src="https://polyfill.io/v3/polyfill.min.js?flags=gated%7Calways&amp;features=Promise%2Cfetch" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?autorun=false"></script>
<script src="url-load-prettify.js"></script>
</body>
</html>
