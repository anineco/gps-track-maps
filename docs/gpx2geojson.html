<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>GPX2GeoJSON（GPX→GeoJSONコンバータ）</title>
<link rel='stylesheet' href='common.css'>
</head>
<body>
<div class="menu">
<ul>
<li><a href="https://anineco.nyanta.jp/">電脳覚書</a> |</li>
<li><a href="https://anineco.nyanta.jp/bbs/">掲示板</a> &gt;</li>
<li><a href="https://github.com/anineco/">GitHub</a> |</li>
<li><a href=".">TOP</a> &gt;</li>
<li>GPX2GeoJSON |</li>
<li><a href="setup.html">設置方法（共通）</a> |</li>
<li><a href="omap.html">OpenLayers</a> |</li>
<li><a href="lmap.html">Leaflet</a> |</li>
<li><a href="gmap.html">Google</a> |</li>
<li><a href="bmap.html">Bing</a></li>
</ul>
</div><!-- end menu -->
<h1>GPX2GeoJSON（GPX→GeoJSONコンバータ）</h1>
<ul>
<li>更新情報（2019-07-07）：GPX2GeoJSONを公開。
<img src="share/new.gif" alt="NEW" height="11" width="20"></li>
<li>このサイトに関するご意見・ご質問・ご要望は、<a href="http://anineco.nyanta.jp/bbs/">サポート掲示板</a>へお願いします。</li>
</ul>
<h2>GPX2GeoJSONとは？</h2>
<p>GPX2GeoJSON（GPX→GeoJSONコンバータ）は、カシミール3Dで保存した<b>GPXファイル</b>（拡張子 .gpx）を、各種ウェブ地図に上乗せして表示できる<b>GeoJSONファイル</b>（拡張子 .geojson）に変換するデスクトップアプリケーションです。Windows 10、macOS、Linuxで動作します。2008年1月から公開している<a href="https://anineco.github.io/gpx2jsgi/gpx2jsgi.html">GPX2JSGI</a>（GPX→KMLコンバータ）と同様、作者のホームページ（<a href="https://anineco.org/">あにねこ登山日誌</a>）の山行記録に添えるルート地図を作成するためのユーティリティとして開発したものです。当初は上乗せデータとしてJSGIファイル、2013年12月からはKMLファイルを利用していましたが、主流になりつつあるGeoJSONファイルへ2019年2月に移行しました。その際に、コンセプトはGPX2JSGIから引き継ぎつつ、全く新規に開発したアプリケーションです。</p>
<h3>主な機能と特徴</h3>
<ul>
<li>カシミール3Dで保存したGPXファイルを、国土地理院が提案する<a href="https://github.com/gsi-cyberjapan/geojson-with-style-spec">スタイルつきGeoJSON規約</a>に準拠したGeoJSONファイルに変換します。</li>
<li>グラフィカルユーザインタフェース（GUI）を備え、ファイル形式の中身について知らなくても、簡単に変換できます。</li>
<li>変換したGeoJSONファイルは、<a href="https://maps.gsi.go.jp/">地理院地図</a>にドラッグ＆ドロップして、すぐに表示を確認することができます。</li>
<li>複数のGPXファイルをまとめて、単一のGeoJSONファイルに変換します（マージ機能）。</li>
<li>変換の際、トラックポイントをcross track errorアルゴリズムを用いて間引くことができます（GPSBabelを利用）。</li>
<li>GPX2GeoJSONはPerl/Tkで記述され、そのソースコードはGitHubで公開しています。</li>
<li>Windows 10では、実行に必要なファイルをパッケージ化したEXEファイルが用意されているので、Perlをインストールしなくても動作します。</li>
</ul>
<h3>動作環境</h3>
<p>Windows 10で動作します。また、macOSやLinuxなど、標準でPerlが動く環境ならば動作し、GUIの他、CLI（コマンドラインインターフェース）でも動作します。EXEファイルへのパッケージ化には<a href="http://strawberryperl.com/">Strawberry Perl for Windows</a>のPAR::Packerツールキットを利用しています。なお、動作させるだけならばPerlのインストールは必要ありません。トラックポイントの間引きで外部プログラムのGPSBabelを利用しているため、別途入手してインストールする必要があります。</p>
<h3>著作権について</h3>
<p>GPX2GeoJSONのソフトウェアおよび付属文書の著作権は、作者のあにねこ（anineco@nifty.com）が保持します。本ソフトウェアはMITライセンスに基づいて無償で提供され、複製を入手した人は商用・非商用を問わず自由に使用、複写、変更、結合、掲載、配布することができます。本ソフトウェアの複製または変更した物を掲載、配布する場合は、ソースコード中の著作権表示は削除できません。</p>
<h3>免責事項</h3>
<p>本ソフトウェアは無保証です。特に、変換結果のデータ形式の正当性・正確性については保証しません。作者は本ソフトウェアに起因するいかなる義務（サポートを含む）についても責任を負いません。</p>
<h2>導入方法</h2>
<h3>インストール</h3>
<div style="float:right;text-align:center;font-size:small;padding:5px;margin:5px;border:dashed 2px gray;background:white;"><img src="share/github.png" width="215" height="115" alt=""><br>図1 GitHubダウンロード画面</div>
<p>まず、GitHubからGPX2GeoJSONの最新版をダウンロードします。<a href="https://github.com/anineco/gpx2geojson">https://github.com/anineco/gpx2geojson</a>にアクセスするとGPX2GeoJSONのリポジトリ画面が開きます。<span style="font-size:small;background:green;color:white;padding:2px;border-radius:2px;">Clone or download</span>をクリックすると図1の小窓が開き、続いて<span style="color:blue;">Download ZIP</span>をクリックするとダウンロードが始まります。</p>
<p>ダウンロードしたZIPファイルを適当なフォルダの下で展開すると、下記のファイル（2019-06-15現在）が配置されます。このうち、実行に必要なファイルは赤字で示した<code>gpx2geojson.exe</code>と<code>iconlut.pm</code>の2つです。この2つのファイルはどこに置いても動作しますが、常に同じフォルダ内に配置する必要があります。</p>
<div class="src">
<div>ディレクトリ構成図</div>
<pre>
gpx2geojson
├── <b>gpx2geojson.exe</b> （実行形式ファイル）
├── <b>iconlut.pm</b> （アイコン変換表）
├── iconlut_anineco.pm（アイコン変換表：あにねこ登山日誌）
├── docs/*            （GitHub Pages）
├── gpx2geojson.pl    （Perlスクリプト）
├── pl2exe.cmd        （EXE化バッチファイル）
├── kml2geojson.pl    （KML→GeoJSONコンバータ）
└── example/*         （サンプルデータ）
</pre>
</div><!-- .src -->
<p>GPSBabelは、公式ウェブサイト<a href="https://www.gpsbabel.org/">https://www.gpsbabel.org/</a>からWindows用（2019-06-15現在、GPSBabel-1.6.0-Setup-exe）をダウンロードしてインストールして下さい。インストール先は通常<code>'C:\Program Files (x86)\GPSBabel'</code>で、GPX2GeoJSONはここに外部プログラム<code>gpsbabel.exe</code>があることを前提として動作します。</p>
<h3>アンインストール</h3>
<p>GPX2GeoJSONのアンインストールは、展開したフォルダをまるごと削除して下さい。GPX2GeoJSONを一度起動して終了すると、ホームフォルダ直下に.gpx2geojsonというファイルが作成されます。アンインストールの際には、このファイルも削除して差し支えありません。</p>
<h2>操作方法</h2>
<h3>起動</h3>
<p><code>gpx2geojson.exe</code>（<img src="share/perl_small.png" alt="">のアイコン）をクリックすると、GUIが起動して図1のような窓が開きます。</p>
<p style="text-align:center;"><img src="share/gui1.png" alt="図1" height="254" width="728"><br>図1 GUI画面</p>
<h3>入出力ファイル指定</h3>
<p>変換したいGPXファイル（1個以上）を、右側の『←追加』ボタンを押してファイル選択ダイアログを開き、「GPXファイル」のリストに追加します。ファイル選択ダイアログでは、ControlキーやShiftキーを押しながらクリックすることにより、複数ファイルを同時に選択することができます。リスト中のファイルをマウスで選択して『除外』ボタンを押すと、リストから取り除くことが出来ます。また、『クリア』ボタンを押すと、リストは空になります。</p>
<p>次に、「出力ファイル」を右側の『選択』ボタンを押して指定します。拡張子を指定しなかった場合は、自動的に.geojsonが付加されます。</p>
<h3>線の透過率、線種、線幅の指定</h3>
<p>線の透過率は元のGPXファイルにはない情報です。スピンボックスで0.0〜1.0の値を0.1刻みで指定します。線種と線幅は元のGPXファイルに含まれる情報です。これをそのままGeoJSONファイルに反映させる場合には、『GPX』にチェックを入れます。その他の場合、指定した値で上書きされます。</p>
<h3>トラックポイント間引き設定</h3>
<p>トラックポイントを間引く場合は、「軌跡を間引く」欄にチェックを入れて下さい。すると、その下の「許容誤差」のスピンボックスが編集可能になるので、正の数値（単位はkm）を設定します。間引きには、cross track errorアルゴリズムを用いたGPSBabelのSimplifyフィルタを利用しています。許容誤差を大きくすると間引かれる点数が増えますが、軌跡の細部の形状が失われるので、調節が必要です。最初は初期設定値（0.005km）で試してみて下さい。</p>
<p style="text-align:center;"><img src="share/gui2.png" alt="図2" height="254" width="728"><br>図2 変換準備完了後のGUI画面</p>
<h3>変換実行</h3>
<p>全ての必要項目を設定したのちに『変換』ボタンを押すと、変換結果が「出力ファイル」で指定したファイルに出力されます。変換が成功すると、変換後のトラックポイント数が「軌跡点数」の欄に表示されます。『終了』ボタンを押すと、プログラムを終了します。</p>
<h2>変換仕様</h2>
<p>変換仕様については、<a href="https://anineco.github.io/gpx2jsgi/gpx2jsgi.html">GPX2JSGI</a>の仕様をほぼそのまま踏襲しています。</p>
<h3>ウェイポイント</h3>
<p>カシミール3Dの「ウェイポイント/ルートポイントのプロパティ」（図4）の設定項目が、地理院地図でどのように表示されるかを説明します。</p>
<p style="text-align:center;"><img src="share/wptprop.png" alt="図4" height="343" width="403"><br>図4 ウェイポイント/ルートポイントのプロパティ</p>
<ul>
  <li><strong>アイコン</strong>：カシミール3Dで指定したアイコンは、GPX形式の中では「コード番号」で記録されます。GPX2GeoJSONはiconlut.pmの設定に基づいて、コード番号を対応するシンボル画像のURLに変換します。配布しているiconlut.pmの内容は簡単なPerlスクリプトで、次のようなものです。
<div class="src">
<div>iconlut.pm</div>
<pre>package iconlut;
use strict;
use warnings;
sub iconUrl {
  my $icon = shift; # kashmir3d:icon
  return &quot;https://map.jpn.org/icon/$icon.png&quot;;
}
sub iconSize {
  my $icon = shift; # kashmir3d:icon
  return [24, 24];
}
sub iconAnchor {
  my $icon = shift; # kashmir3d:icon
  return [12, 12];
}
1;
</pre>
</div><!-- .src -->
この設定では、<code>https://map.jpn.org/</code>に設置済のシンボル画像のセットにアクセスします。この画像セットは、カシミール3Dのアイコンの全てに対応しています。</li>
  <li><strong>名前</strong>、<strong>GPSでの備考</strong>：地理院地図において、シンボル（点型データ）にマウスポインタを重ねると、ポップアップ窓で表示されます。GPSでの備考にはシンボルの属性情報を「項目名1=値1,項目名2=値2,…」のように項目名と値を「=」（イコール）で接続し、カンマ区切りで列挙して記述します。</li>
</ul>
<h3>ルート</h3>
<p>カシミール3Dの「ルートデータプロパティ」（図5）の設定項目が、地理院地図でどのように表示されるかを説明します。</p>
<p style="text-align:center;"><img src="share/rteprop.png" alt="図5" height="232" width="455"><br>図5 ルートデータプロパティ</p>
<ul>
<li><strong>表示色</strong>：カシミール3Dで指定した色で表示されます。透過率はGPX2GeoJSONで変換する際に指定します。</li>
<li><strong>線幅</strong>：カシミール3Dで指定した幅（1〜9）を地図上の幅（単位はピクセル）として表示します。地図の縮尺を変えても線幅は変化しません。</li>
<li><strong>線種</strong>：カシミール3Dで指定した種類のうち、実線、短長の破線、点線、一点鎖線、二点鎖線が表示可能です。</li>
</ul>
<p>カシミール3Dでは、ルート上の各ポイントに対しても図4の「ウェイポイントのプロパティ」を開いて、全く同様のプロパティを設定することができます。ルートポイントもウェイポイントと同様にGeoJSON形式に変換されました。ただし、アイコンが「地名」グループの「なし」（コード番号903001）のルートポイントは例外で、変換されません（「なし」アイコンのウェイポイントは変換されます）。ルートポイントを変換したくない場合は、アイコンを「なし」に設定して下さい。複数のルートポイントを選択してから「ウェイポイントのプロパティ」を開くと、アイコンの一括変更が可能です。</p>
<h3>トラック</h3>
<p>カシミール3Dの「トラックデータプロパティ」（図6）の設定項目が、地理院地図でどのように表示されるかを説明します。</p>
<p style="text-align:center;"><img src="share/trkprop.png" alt="図6" height="235" width="494"><br>図6 トラックデータプロパティ</p>
<ul>
<li><strong>表示色</strong>、<strong>線幅</strong>、<strong>線種</strong>：ルートの場合と同様です。</li>
<li><strong>アイコン</strong>：トラックデータに指定したアイコンは変換対象外です。</li>
</ul>
<h2><a name="history">更新履歴</a></h2>
<table class="base">
  <tbody>
    <tr>
      <td valign="top" class="nowrap;">2019-07-07</td>
      <td valign="top">GPX2GeoJSON Ver.0.9 公開。</td>
    </tr>
  </tbody>
</table>
<hr>
<address>&copy; 2019 <a href="https://anineco.nyanta.jp/">あにねこ電脳覚書</a></address>
</body>
</html>
