<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ルート地図の設置方法（共通）</title>
<link rel="stylesheet" href="common.css">
<script>
function routemap(url) {
  window.open(url, 'ROUTEMAP', 'width=640,height=510,resizable=yes');
  return false;
}
</script>
</head>
<body>
<div class="menu">
<ul>
<li><a href="https://anineco.nyanta.jp/">電脳覚書</a> |</li>
<li><a href="https://anineco.nyanta.jp/bbs/">掲示板</a> &gt;</li>
<li><a href="https://github.com/anineco/">GitHub</a> |</li>
<li><a href=".">TOP</a> &gt;</li>
<li><a href="../gpx2geojson/">GPX2GeoJSON</a> |</li>
<li>設置方法（共通） |</li>
<li><a href="omap.html">OpenLayers</a> |</li>
<li><a href="lmap.html">Leaflet</a> |</li>
<li><a href="gmap.html">Google</a> |</li>
<li><a href="bmap.html">Bing</a></li>
</ul>
</div><!-- end menu -->
<h1>ルート地図の設置方法（共通）</h1>
<p>本サイトで説明している各種ルート地図やGPX2GeoJSONのソースコードはGitHubで管理しているので、ソースコードの入手には<b>git</b>（バージョン管理システム）があると便利です。Windows 10でgitを使うには、Windows Subsystem for Linux（WSL）の<b>Ubuntu</b>を利用するのがお勧めです（特にWeb開発やオープンソースを利用した開発では必須）。UbuntuはMicrosoftストアから無料でインストールできます。以降のコマンド実行は、Ubuntuを起動して開くBashシェルの窓の中で行います。</p>
<h2>ソースコードの入手方法</h2>
<p>各種ルート地図やGPX2GeoJSONのソースコード一式を入手するコマンドは次の通り。下記のディレクトリ構成に示すように保存されます。</p>
<div class="src">
<div>コマンド実行：ソースコードの入手</div>
<pre>
git clone https://github.com/anineco/gps-track-maps.git
</pre>
</div><!-- .src -->
<div class="src">
<div>ディレクトリ構成</div>
<pre>
gps-track-maps/
├── docs/
│   ├── <b>lmap_ex2.html</b> （Leaflet + GeoJSON）
│   ├── <b>gmap_ex2.html</b> （Googleマップ + GeoJSON）
│   ├── <b>bmap_ex2.html</b> （Bing Maps + GeoJSON）
│   ├── lmap_ex1.html （Leaflet + KML）
│   ├── gmap_ex1.html （Googleマップ + KML）
│   ├── bmap_ex1.html （Bing Maps + KML）
│   ├── ymap_ex1.html （Yahoo!地図 + KML）
│   └── example/
│       ├── routemap.min.kml （KMLファイル）
│       └── routemap.geojson （GeoJSONファイル）
├── package-lock.json
├── package.json
└── src/
    ├── <b>omap_ex2.html</b> （OpenLayers + GeoJSON）
    ├── omap_ex2.js
    ├── omap_ex1.html （OpenLayers + KML）
    ├── omap_ex1.js
    ├── Popup.*
    └── Toolbar.*
</pre>
</div><!-- .src -->
<p>このうち、ディレクトリdocs以下のファイルは、必要に応じて編集したのち、対象サイトに設置して用います。ディレクトリsrc以下はOpenLayers関連のファイルで、npmによる処理を経て、docsに生成されたファイルを対象サイトに設置します。詳しくは<a href="omap.html">ルート地図（OpenLayers版）</a>を参照してください。</p>
<p>対象サイトへのファイルの設置方法は、ファイル名が異なるだけで共通です。routemap.geojsonの代わりにKMLファイルroutemap.min.kmlを上乗せ表示する場合は、Xmap_ex1.html（X=b,g,l,o,y）を用いて下さい。以下、次のようなディレクトリ構成に設置した場合を例として、二種類の表示方式について説明します。</p>
<div class="src">
<div>ディレクトリ構成図（GeoJSON）</div>
<pre>
.
├── your_page.html（対象ページ）
├── <b>Xmap_ex2.html</b>（X=b,g,l,o）
└── example
    └── <b>routemap.geojson</b>
</pre>
</div><!-- .src -->
<p>OpenLayers版ルート地図の場合は、この他にも必要なファイルがあります。<a href="omap.html">ルート地図（OpenLayers版）</a>を参照して下さい。</p>
<h2>ページ内埋め込み</h2>
<p>対象ページにルート地図を埋め込んで表示する場合は、対象ページ（your_page.html）に次のようなHTMLコードを挿入します。各パラメータの意味は共通で、以下の表の通り。</p>
<div class="src">
<div>対象ページに挿入するHTMLコード</div>
<pre>
&lt;iframe width=&quot;640&quot; height=&quot;480&quot; style=&quot;border:none;&quot;
  src=&quot;<b>Xmap_ex2.html</b>?lat=35.913163&amp;lon=138.721400&amp;zoom=15&amp;url=<b>example/routemap.geojson</b>&quot;&gt;
&lt;/iframe&gt;
</pre>
</div><!-- .src -->
<table class="base">
<tbody>
<tr><th>パラメータ名</th><th>設定値の例</th><th>説明</th></tr>
<tr><td>lat</td><td>35.913163</td><td>緯度（単位：度）</td></tr>
<tr><td>lon</td><td>138.721400</td><td>経度（単位：度）</td></tr>
<tr><td>zoom</td><td>15</td><td>ズームレベル</td></tr>
<tr><td>url</td><td>example/routemap.geojson</td><td>GeoJSONファイル</td></tr>
</tbody>
</table>
<ul style="list-style-type:none;">
<li>※1：<code>Xmap_ex<b>1</b>.html</code>（X=b,g,l,o,y）の場合も、<code>url</code>がKMLファイルを指定する他は、同様です。</li>
<li>※2：<code>gmap_ex1.html</code>と<code>ymap_ex1.html</code>では、KMLファイルは<b>絶対URL</b>で指定します。</li>
<li>※3：<code>ymap_ex1.html</code>では、<code>zoom+1</code>が実際に表示されるズームレベルとなります。</li>
</ul>
<h2>別窓ポップアップ</h2>
<p>対象ページに次のJavaScriptとHTMLコードを挿入すると、<a href="lmap_ex2.html?lat=35.913163&lon=138.721400&zoom=15&url=example/routemap.geojson" onclick="return routemap(this.href)">ルート地図</a>のようなリンクができ、クリックすると別窓がポップアップしてルート地図を表示します。</p>
<div class="src">
<div>対象ページに挿入するJavaScriptコード</div>
<pre>
function routemap(url) {
  window.open(url, 'ROUTEMAP', 'width=640,height=510,resizable=yes');
  return false;
}
</pre>
</div><!-- .src -->
<div class="src">
<div>対象ページに挿入するHTMLコード</div>
<pre>
&lt;a href=&quot;<b>Xmap_ex2.html</b>?lat=35.913163&amp;lon=138.721400&amp;zoom=15&amp;url=<b>example/routemap.geojson</b>&quot;
  onclick=&quot;return routemap(this.href)&quot;&gt;ルート地図&lt;/a&gt;
</pre>
</div><!-- .src -->
<h2>付録：ルート地図（Yahoo!地図版）の設置</h2>
<p>Yahoo!地図については、GeoJSONファイルを上乗せ表示する簡単な方法が用意されていないようです。参考のため、KMLファイルを上乗せ表示するソースコードをここで示します。'[YOUR API KEY]'の個所は、各自が取得したアプリケーションIDに書き換えて下さい。</p>
<div class="src">
<div>ymap_ex1.html（<a href="ymap_ex1.html" download>ダウンロード</a>）</div>
<pre class="prettyprint linenums" data-url="ymap_ex1.html"></pre>
</div><!-- .src -->
<div class="src">
<div>ymap_ex1.html の変更個所（28行目）</div>
<pre>
&lt;script src=&quot;https://map.yahooapis.jp/js/V1/jsapi?appid=<b>[YOUR API KEY]</b>&quot;&gt;&lt;/script&gt;
</pre>
</div><!-- .src -->
<address>&copy; 2019 <a href="http://anineco.nyanta.jp/">あにねこ電脳覚書</a></address>
<script src="https://polyfill.io/v3/polyfill.min.js?flags=gated%7Calways&features=Promise%2Cfetch" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js?autorun=false"></script>
<script src="url-load-prettify.js"></script>
</body>
</html>
